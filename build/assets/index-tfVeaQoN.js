import{r as i,u as A,s as T,t as N,x as V,a as d,b as a,i as U,j,o as n,d as z,B as M,F as w,z as k,h as P,l as I,n as C,A as h}from"./index-BZlZztwk.js";import{_ as L}from"./orders.vue_vue_type_script_setup_true_lang-B96A8iBV.js";import{S as R}from"./spinner-2k92dcTC.js";import{u as W}from"./staff-D1zJf4JU.js";import{i as q}from"./index-BTutWPBR.js";const G={class:"bg-white py-2 mt-3"},H={class:"mt-8"},J={class:"container mx-auto px-4 lg:px-0"},K={key:0,class:"mb-5 w-full"},O={class:"mb-5 flex items-center justify-between"},Q=a("p",{class:"text-xl font-bold"},[I(" График работы "),a("span",{class:"text-red-500"},"*")],-1),X=a("option",{value:15}," 15 мин ",-1),Y=a("option",{value:30}," 30 мин ",-1),Z=a("option",{value:45}," 45 мин ",-1),ee=[X,Y,Z],te=a("p",{class:"font-medium bg-[#E7F0FF] py-1 px-4 mb-5 rounded"}," Дни приема ",-1),se={class:"flex flex-row flex-wrap gap-3 mb-5"},ae=["onClick"],le=a("p",{class:"font-medium bg-[#E7F0FF] py-1 px-4 mb-5 rounded"}," Время приема ",-1),oe={class:"flex flex-wrap gap-1 lg:gap-2"},ne=["onClick"],re={key:1,class:"bg-[#1EDA00] cursor-pointer text-white mt-4 text-center py-2 rounded-lg"},ue=a("span",{class:"spinner"},null,-1),de=[ue],_e={__name:"index",setup(ie){const S=i("profile"),_=i(!1),c=i(!1),f=A(),{result:v}=T(f),m=W(),r=i([]),y=i([{title:"Понедельник",value:1},{title:"Вторник",value:2},{title:"Среда",value:3},{title:"Четверг",value:4},{title:"Пятница",value:5},{title:"Суббота",value:6},{title:"Воскресенье",value:7}]),x=(t,e)=>{q(t,{type:e,autoClose:1e3})};function g(t){const e=[];let s=0,o=0;for(;s<24;){const u=`${s.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`;o+=t,o>=60&&(s+=1,o=0);const D=`${s.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`;e.push({start:u,end:D})}return e}const p=i([]),b=t=>{E(t.value)?l.value.schedule.days=l.value.schedule.days.filter(e=>e.weekday_number!==t.value):l.value.schedule.days.push({weekday_number:t.value,times:[]})},E=t=>l.value.schedule.days.some(e=>e.weekday_number===t);N(async()=>{await V(),await f.getProfile(),l.value.schedule.duration=v.value.data.staff.schedule[0].duration,p.value=g(l.value.schedule.duration),_.value=!1,v.value.data.staff.schedule.forEach(t=>{const e=y.value.find(s=>s.value===t.weekday_number);e&&b(e)}),r.value=v.value.data.staff.schedule[0].times});const l=i({schedule:{duration:15,days:[],times:[]}}),F=()=>{r.value=[],p.value=[],p.value=[...g(l.value.schedule.duration)],l.value.schedule.days=[]},$=async()=>{c.value=!0,l.value.schedule.days=l.value.schedule.days.map(t=>({...t,times:r.value.filter(e=>e.start&&e.end)})),await m.updateSchedule(v.value.data.staff.id,l.value),m.resultUpdatedSchedule.value!==!1?(await f.getProfile(),c.value=!1,x("График успешно обновлен","success")):(c.value=!1,x("Произошла ошибка","error"))},B=t=>{r.value.some(e=>e.start===t.start&&e.end===t.end)?r.value=r.value.filter(e=>e.start!==t.start||e.end!==t.end):r.value.push(t)};return(t,e)=>(n(),d("div",G,[a("div",H,[a("div",J,[U(L,{name:S.value},{default:j(()=>[_.value?(n(),P(R,{key:1})):(n(),d("div",K,[a("div",O,[Q,z(a("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>l.value.schedule.duration=s),onChange:F,class:"p-3 border w-max rounded-lg",name:"",id:""},ee,544),[[M,l.value.schedule.duration]])]),te,a("div",se,[(n(!0),d(w,null,k(y.value,(s,o)=>(n(),d("div",{key:o,onClick:u=>b(s),class:C([{"bg-mainColor text-white":l.value.schedule.days.some(u=>u.weekday_number===s.value)},"w-max px-3 py-2 border text-xs border-[#ECECEC] rounded text-center cursor-pointer transition-all"])},h(s.title),11,ae))),128))]),le,a("div",oe,[(n(!0),d(w,null,k(p.value,(s,o)=>(n(),d("p",{key:o,onClick:u=>B(s),class:C([{"bg-mainColor text-white":r.value.some(u=>u.start===s.start&&u.end===s.end)},"cursor-pointer w-third lg:w-fifth transition-all border border-[#ECECEC] rounded text-center py-2 bg-[#F6F6F7] text-[#9A9BA4]"])},h(s.start)+" - "+h(s.end),11,ne))),128))]),a("div",null,[c.value?(n(),d("p",re,de)):(n(),d("p",{key:0,onClick:$,class:"bg-[#1EDA00] cursor-pointer text-white mt-4 text-center py-2 rounded-lg"}," Сохранить "))])]))]),_:1},8,["name"])])])]))}};export{_e as default};
